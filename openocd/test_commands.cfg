# =============================================================================
# OpenOCD Test Script for cJTAG Bridge
# =============================================================================
# This script demonstrates basic OpenOCD commands for testing the cJTAG bridge
# Run with: openocd -f openocd/cjtag.cfg -f openocd/test_commands.cfg
# =============================================================================

# Wait for initialization to complete
sleep 100

echo "=========================================="
echo "cJTAG Bridge OpenOCD Test Commands"
echo "=========================================="

# Display scan chain
echo "Scanning JTAG chain..."
scan_chain

# Read IDCODE
echo ""
echo "Reading IDCODE..."
jtag arp_init
irscan riscv.cpu 0x01
drscan riscv.cpu 32 0

# Display TAP state
echo ""
echo "TAP information:"
jtag names
jtag tapisenabled riscv.cpu
jtag tapisabled riscv.cpu

# Try to halt (will fail without real CPU, but tests communication)
echo ""
echo "Testing target communication..."
catch {halt} msg
echo "Result: $msg"

echo ""
echo "=========================================="
echo "Test complete"
echo "=========================================="
echo ""
echo "If you saw IDCODE 0x1dead3ff, the cJTAG bridge is working!"
echo ""
echo "Next steps:"
echo "  - View waveform: make wave"
echo "  - Connect GDB: target remote localhost:3334"
echo ""

# Keep OpenOCD running
echo "OpenOCD is running. Press Ctrl+C to exit."
